services:
  - type: web
    name: api
    env: docker
    rootDir: .
    region: oregon
    healthCheckPath: /health
    dockerfilePath: docker/server.Dockerfile
    buildCommand: docker build -t api -f docker/server.Dockerfile .
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DATABASE_URL
        sync: false # This will be set manually in the dashboard
    preDeployCommand: cd apps/server && bun run db:migrate && bun run db:push
    buildFilter:
      paths:
        - apps/server/**
        - packages/types/**
        - docker/**
      ignoredPaths:
        - apps/server/**/*.test.ts
        - apps/server/**/*.spec.ts
        - apps/server/**/README.md
